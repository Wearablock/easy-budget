# frozen_string_literal: true

# Fastfile for Easy Budget
#
# IAP ìƒí’ˆ ê´€ë¦¬:
#   fastlane sync_iap          - ëª¨ë“  IAP ìƒí’ˆ ë™ê¸°í™”
#   fastlane list_iap          - ë“±ë¡ëœ ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
#
# í•„ìš” ì¡°ê±´:
#   gem install google-apis-androidpublisher_v3

default_platform(:android)

# ============================================================
# IAP ê´€ë¦¬ ë ˆì¸
# ============================================================

desc "Sync all IAP products to Google Play Console"
lane :sync_iap do
  require_relative 'iap/sync_iap'
  GooglePlayIAPSync.new.sync_all
end

desc "List all IAP products"
lane :list_iap do
  require_relative 'iap/sync_iap'
  GooglePlayIAPSync.new.list_products
end

desc "Create IAP product"
lane :create_iap do |options|
  require_relative 'iap/sync_iap'
  file = options[:file] || 'easy_budget_premium.json'
  GooglePlayIAPSync.new.create_product(file)
end

desc "Update IAP product"
lane :update_iap do |options|
  require_relative 'iap/sync_iap'
  file = options[:file] || 'easy_budget_premium.json'
  GooglePlayIAPSync.new.update_product(file)
end

desc "Get IAP product info"
lane :get_iap do |options|
  require_relative 'iap/sync_iap'
  sku = options[:sku]
  if sku.nil?
    UI.user_error!("SKUë¥¼ ì§€ì •í•˜ì„¸ìš”. ì˜ˆ: fastlane get_iap sku:easy_budget_premium")
  end
  GooglePlayIAPSync.new.get_product(sku)
end

# ============================================================
# iOS IAP ê´€ë¦¬ ë ˆì¸
# ============================================================

desc "Sync IAP localizations to App Store Connect"
lane :sync_iap_ios do |options|
  require_relative 'iap/sync_iap_ios'
  file = options[:file] || 'easy_budget_premium.json'
  AppStoreConnectIAPSync.new.sync_localizations(file)
end

desc "List all IAP products on App Store Connect"
lane :list_iap_ios do
  require_relative 'iap/sync_iap_ios'
  AppStoreConnectIAPSync.new.list_iaps
end

# ============================================================
# í†µí•© ë ˆì¸ (Android + iOS ë™ì‹œ ë™ê¸°í™”)
# ============================================================

desc "Sync IAP to both Android and iOS"
lane :sync_iap_all do |options|
  file = options[:file] || 'easy_budget_premium.json'

  UI.message("ğŸ¤– Android IAP ë™ê¸°í™”...")
  sync_iap(file: file)

  UI.message("")
  UI.message("ğŸ iOS IAP ë™ê¸°í™”...")
  sync_iap_ios(file: file)

  UI.success("âœ… ëª¨ë“  í”Œë«í¼ ë™ê¸°í™” ì™„ë£Œ!")
end
